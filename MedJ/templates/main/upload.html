{% extends "basetemplates/base_app.html" %}
{% load i18n static %}

{% block content %}
<div class="container mx-auto mt-8 max-w-4xl px-4">

    <form id="uploadForm" novalidate>
        {% csrf_token %}

        <div id="upload-state">
            <div class="bg-teal-50 rounded-full flex items-center justify-center p-3 mb-6 shadow-sm">
                <select id="category" name="category" class="bg-white border-none rounded-full py-2 px-5 text-gray-700 font-semibold focus:ring-2 focus:ring-teal-400">
                    <option value="" selected disabled>{% trans "Вид документ..." %}</option>
                    <option value="blood_test">{% trans "Кръвни изследвания" %}</option>
                    <option value="epicrisis">{% trans "Епикриза" %}</option>
                    <option value="ambulatory_sheet">{% trans "Амбулаторен лист" %}</option>
                    <option value="prescription">{% trans "Рецепта" %}</option>
                </select>
                <span class="mx-4 text-gray-400 font-semibold">{% trans "назначено от" %}</span>
                <select id="specialist" name="specialist" class="bg-white border-none rounded-full py-2 px-5 text-gray-700 font-semibold focus:ring-2 focus:ring-teal-400">
                    <option value="" selected disabled>{% trans "Специалист..." %}</option>
                    <option value="gp">{% trans "Личен лекар" %}</option>
                    <option value="cardiologist">{% trans "Кардиолог" %}</option>
                    <option value="endocrinologist">{% trans "Ендокринолог" %}</option>
                    <option value="laboratory">{% trans "Лаборатория" %}</option>
                </select>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow-md">
                <input type="file" id="file_input" name="document" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-teal-50 file:text-teal-700 hover:file:bg-teal-100 mb-4" accept="image/*,application/pdf">
                <div class="d-grid">
                    <button type="button" id="upload-ocr-button" class="w-full bg-teal-400 hover:bg-teal-500 text-white font-bold py-3 px-4 rounded-full transition duration-300">
                        {% trans "Качи" %}
                    </button>
                </div>
            </div>
        </div>

        <div id="review-state" style="display: none;">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white rounded-2xl shadow-md overflow-hidden">
                    <img id="image-preview" src="#" alt="Preview" class="w-full h-auto object-cover" style="display: none;">
                    <div class="p-4">
                         <h5 class="text-lg font-bold text-gray-800 mb-2">Оригинален текст</h5>
                        <pre id="raw-ocr-output" class="bg-gray-100 p-3 rounded-lg text-sm text-gray-700 max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></pre>
                    </div>
                </div>
                <div>
                    <div class="bg-teal-50 rounded-full flex items-center justify-center p-3 mb-4 shadow-sm">
                        <input type="text" id="category-review" class="bg-white border-none rounded-full py-2 px-5 text-gray-700 font-semibold w-full text-center" disabled>
                        <span class="mx-4 text-gray-400 font-semibold">{% trans "от" %}</span>
                        <input type="text" id="specialist-review" class="bg-white border-none rounded-full py-2 px-5 text-gray-700 font-semibold w-full text-center" disabled>
                    </div>
                    <textarea id="ocr_text_area" class="w-full p-4 border border-gray-300 rounded-2xl h-80 focus:ring-2 focus:ring-teal-400 focus:border-transparent"></textarea>
                    <div class="bg-red-100 border border-red-300 text-red-700 px-4 py-2 rounded-full text-center mt-4 text-sm">
                        <p>{% trans "Моля внимателно проверявайте текста преди одобрение" %}</p>
                    </div>
                    <div class="d-grid mt-4">
                        <button type="button" id="analyze-button" class="w-full bg-teal-400 hover:bg-teal-500 text-white font-bold py-4 px-4 rounded-full transition duration-300 text-lg">
                            {% trans "Одобри и анализирай..." %}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <div id="error-message" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mt-6" style="display: none;"></div>
</div>
{% endblock %}

 {% block scripts %}
    <script src="{% static 'js/upload_logic.js' %}"></script>
 {% endblock %}
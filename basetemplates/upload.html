{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans 'Качване на документ' %} • MedJ{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-6 bg-light p-4 rounded" style="background-color: #fdfee9;">
    <h3 class="mb-3" style="color: #0a4e75;">{% trans 'Качете медицински документ' %}</h3>
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="mb-3">
        <input type="file" name="document" class="form-control" required>
      </div>

      <div class="mb-3">
        <label for="doc_kind" class="form-label">{% trans 'Вид документ' %}</label>
        <select id="doc_kind" name="doc_kind" class="form-select">
          <option value="blood" {% if doc_kind == 'blood' %}selected{% endif %}>{% trans 'кръвни изследвания' %}</option>
          <option value="outpatient" {% if doc_kind == 'outpatient' %}selected{% endif %}>{% trans 'амбулаторен лист' %}</option>
          <option value="epicrisis" {% if doc_kind == 'epicrisis' %}selected{% endif %}>{% trans 'епикриза' %}</option>
          <option value="referral" {% if doc_kind == 'referral' %}selected{% endif %}>{% trans 'направление' %}</option>
          <option value="prescription" {% if doc_kind == 'prescription' %}selected{% endif %}>{% trans 'рецепта' %}</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="file_type" class="form-label">{% trans 'Тип файл' %}</label>
        <select id="file_type" name="file_type" class="form-select">
          <option value="image" {% if file_type == 'image' %}selected{% endif %}>{% trans 'изображение' %}</option>
          <option value="pdf" {% if file_type == 'pdf' %}selected{% endif %}>PDF</option>
        </select>
      </div>
      <button type="submit" class="btn w-100" style="background-color: #43b8cf; color: white;">{% trans 'Качи' %}</button>
    </form>
  </div>
</div>

{% if extracted_text %}
  <div class="row justify-content-center mt-5">
    <div class="col-md-10">
       <h4 style="color:#0a4e75;">{% trans 'Извлечен текст:' %}</h4>
      <div class="p-3 rounded" style="background-color: #f0f0f0; border: 1px solid #ccc; white-space: pre-wrap;">
        {{ extracted_text }}
      </div>
    </div>
  </div>
{% endif %}

{% if extracted_fields %}
  <div class="row justify-content-center mt-5">
    <div class="col-md-8">
      <h4 style="color:#0a4e75;">{% trans 'Разпознати стойности:' %}</h4>
      <table class="table table-bordered mt-3">
        <thead style="background-color: #43b8cf; color: white;">
          <tr>
            <th>{% trans 'Име' %}</th>
            <th>{% trans 'Стойност' %}</th>
          </tr>
        </thead>
        <tbody>
          {% for field, value in extracted_fields.items %}
          <tr>
            <td>{{ field }}</td>
            <td>{{ value }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endif %}
{% endblock %}

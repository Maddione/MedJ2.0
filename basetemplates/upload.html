{% extends "base.html" %}
{% load i18n %}
{% block content %}

<div class="row justify-content-center mt-4">
  <div class="col-md-6 bg-light p-4 rounded" style="background-color: #fdfee9;">
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="file" name="document" accept="image/*,application/pdf" class="form-control mb-3" required>
      <select name="doc_kind" class="form-select mb-3">
        <option value="">{% trans 'Изберете вид документ' %}</option>
        <option value="blood">{% trans 'кръвни изследвания' %}</option>
        <option value="outpatient">{% trans 'амбулаторен лист' %}</option>
        <option value="epicrisis">{% trans 'епикриза' %}</option>
        <option value="referral">{% trans 'направление' %}</option>
        <option value="prescription">{% trans 'рецепта' %}</option>
      </select>
      <select name="file_type" class="form-select mb-3">
        <option value="">{% trans 'Изберете тип файл' %}</option>
        <option value="image">{% trans 'изображение' %}</option>
        <option value="pdf">PDF</option>
      </select>
      <button type="submit" class="btn w-100" style="background-color: #43b8cf; color: white;">
        {% trans 'Качи' %}
      </button>
    </form>
  </div>
</div>

{% if extracted_text %}
  <div class="row justify-content-center mt-4">
    <div class="col-md-8">
      <h4 style="color:#0a4e75;">{% trans 'Извлечен текст (OCR):' %}</h4>
      <pre style="background:#f0f0f0; padding:10px; border-radius:5px;">{{ extracted_text }}</pre>
    </div>
  </div>
{% endif %}

{% if json_output %}
  <div class="row justify-content-center mt-4">
    <div class="col-md-8">
      <h4 style="color:#0a4e75;">{% trans 'Обобщение' %}</h4>
      <p><strong>{% trans 'Дата:' %}</strong> {{ json_output.date }}</p>
      <h5 style="color:#0a4e75;">{% trans 'Таблица (OCR):' %}</h5>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>{% trans 'Показател' %}</th>
            <th>{% trans 'Стойност' %}</th>
            <th>{% trans 'Ед.' %}</th>
            <th>{% trans 'Статус' %}</th>
            <th>{% trans 'Реф. граници' %}</th>
          </tr>
        </thead>
        <tbody>
          {% for name, info in json_output.items %}
            {% if name != 'date' %}
            <tr>
              <td>{{ name }}</td>
              <td>{{ info.value }}</td>
              <td>{{ info.unit }}</td>
              <td>{{ info.status }}</td>
              <td>{{ info.reference }}</td>
            </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endif %}

{% if html_output %}
  <div class="row justify-content-center mt-4">
    <div class="col-md-8">
      <h5 style="color:#0a4e75;">{% trans 'Таблица (GPT):' %}</h5>
      <div>{{ html_output|safe }}</div>
    </div>
  </div>
{% endif %}

{% if summary %}
  <div class="row justify-content-center mt-4">
    <div class="col-md-8">
      <h5 style="color:#0a4e75;">{% trans 'Текст:' %}</h5>
      <p>{{ summary }}</p>
    </div>
  </div>
{% endif %}

{% endblock %}
